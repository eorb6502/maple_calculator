<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Maple one line damage calculator</title>
    <style>
        #checkboxForm {
            display: flex;
            flex-wrap: wrap;
        }
        #checkboxForm label {
            width: 30%;
            margin-bottom: 10px;
        }
        #dropdownForm {
            display: flex;
            flex-wrap: wrap;
        }
        #dropdownForm label {
            width: 10%;
            margin-bottom: 10px;
        }
        #dropdownForm select {
            width: 10%;
            margin-bottom: 10px;
            margin-right: 20px;
        }
        #inputForm {
            display: flex;
            flex-wrap: wrap;
        }
        #inputForm label {
            width: 20%;
            margin-bottom: 10px;
        }
        #inputForm input {
            width: 10%;
            margin-bottom: 10px;
            margin-right: 20px;
        }
        #headerForm {
            display: flex;
            flex-wrap: wrap;
        }
        #headerForm label{
            width: 10%;
            margin-bottom: 10px;
            font-weight: bold;
            font-size: x-large;
        }
        #headerForm p{
            width: 15%;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h2>Insert Character name</h2>
    <label for="nameInput"> Enter character name:</label>
    <input type="text" id="nameInput" name="nameInput"> <br>
    <button type="button" onclick="submitCharactername()">Submit</button>

    <h2>Select Dopings</h2>
    <form id="checkboxForm">
        <label><input type="checkbox" name="doping" value="보스 킬링 머신"> 보스 킬링 머신</label><br>
        <label><input type="checkbox" name="doping" value="방어력은 숫자일 뿐"> 방어력은 숫자일 뿐</label><br>
        <label><input type="checkbox" name="doping" value="길드의 이름으로"> 길드의 이름으로</label><br>
        <label><input type="checkbox" name="doping" value="크게 한방"> 크게 한방</label><br>
        <label><input type="checkbox" name="doping" value="향상된 10단계 힘의 물약"> 향상된 10단계 힘의 물약</label><br>
        <label><input type="checkbox" name="doping" value="향상된 10단계 민첩의 물약"> 향상된 10단계 민첩의 물약</label><br>
        <label><input type="checkbox" name="doping" value="향상된 10단계 지능의 물약"> 향상된 10단계 지능의 물약</label><br>
        <label><input type="checkbox" name="doping" value="향상된 10단계 행운의 물약"> 향상된 10단계 행운의 물약</label><br>
        <label><input type="checkbox" name="doping" value="와헌"> 와헌</label><br>
        <label><input type="checkbox" name="doping" value="찐어블"> 찐어블</label><br>
        <label><input type="checkbox" name="doping" value="쓸어블"> 쓸어블</label><br>
        <label><input type="checkbox" name="doping" value="찐샾"> 찐샾</label><br>
        <label><input type="checkbox" name="doping" value="쓸샾"> 쓸샾</label><br>
        <label><input type="checkbox" name="doping" value="영메"> 영메</label><br>
        <label><input type="checkbox" name="doping" value="유니온의 힘"> 유니온의 힘</label><br>
        <label><input type="checkbox" name="doping" value="mvp 슈퍼파워"> mvp 슈퍼파워</label><br>
        <label><input type="checkbox" name="doping" value="우뿌"> 우뿌</label><br>
        <label><input type="checkbox" name="doping" value="붕뿌"> 붕뿌</label><br>
        <label><input type="checkbox" name="doping" value="인기도 버프(250)"> 인기도 버프(250)</label><br>
        <label><input type="checkbox" name="doping" value="인기도 버프(275)"> 인기도 버프(275)</label><br>
        <label><input type="checkbox" name="doping" value="길축"> 길축</label><br>
        <label><input type="checkbox" name="doping" value="길더축"> 길더축</label><br>
        <label><input type="checkbox" name="doping" value="반황별"> 반황별</label><br>
        <label><input type="checkbox" name="doping" value="반빨별"> 반빨별</label><br>
        <label><input type="checkbox" name="doping" value="반파별"> 반파별</label><br>
        <label><input type="checkbox" name="doping" value="고급 보스 킬러의 비약"> 고급 보스 킬러의 비약</label><br>
        <label><input type="checkbox" name="doping" value="고급 대영웅의 비약"> 고급 대영웅의 비약</label><br>
        <label><input type="checkbox" name="doping" value="고급 관통의 비약"> 고급 관통의 비약</label><br>
        <label><input type="checkbox" name="doping" value="고급 대축복의 비약"> 고급 대축복의 비약</label><br>
        <label><input type="checkbox" name="doping" value="전설의 영웅 비약"> 전설의 영웅 비약</label><br>
        <label><input type="checkbox" name="doping" value="전설의 축복 비약"> 전설의 축복 비약</label><br>
        <label><input type="checkbox" name="doping" value="전설의 체력 비약"> 전설의 체력 비약</label><br>
        <label><input type="checkbox" name="doping" value="전설의 마나 비약"> 전설의 마나 비약</label><br>
        <label><input type="checkbox" name="doping" value="익스트림 레드"> 익스트림 레드</label><br>
        <label><input type="checkbox" name="doping" value="익스트림 블루"> 익스트림 블루</label><br>
        <label><input type="checkbox" name="doping" value="VIP 버프"> VIP 버프</label><br>
        <label><input type="checkbox" name="doping" value="아기 용의 이유식"> 아기 용의 이유식</label><br>
        <label><input type="checkbox" name="doping" value="무기 제련"> 무기 제련</label><br>
        <label><input type="checkbox" name="doping" value="고급 무기 제련"> 고급 무기 제련</label><br>  
    </form>
    <h2>Select Map</h2>
    <form id="dropdownForm">
    <label for="force_type"> Select force type:</label>
        <select id="force_type" name="force_type" onchange="update_map_region()">
            <option value="arcane">아케인포스</option>
            <option value="authentic">어센틱포스</option>
        </select>
    
        <label for="map_region"> Select map region:</label>
        <select id="map_region" name="map_region" onchange="update_map_name()" disabled>
            
        </select>

        <label for="map_name"> Select map name:</label>
        <select id="map_name" name="map_name" disabled>
            
        </select>
    </form> 
    <h2>Input Skill spec</h2>
    <form id="inputForm">
        <label for="skill_damage"> damage%/100 (contains passive effect):</label>
        <input type="text" id="skill_damage" name="skill_damage"> 
        <label for="attack_count"> attack count (contains hyper passive):</label>
        <input type="text" id="attack_count" name="attack_count"> 
        <label for="hyper_damage"> skill damage+ (ex 0.7):</label>
        <input type="text" id="hyper_damage" name="hyper_damage"> <br>
        <label for="core_reinforce"> core reinforce (ex 1.2):</label>
        <input type="text" id="core_reinforce" name="core_reinforce">
        <label for="core_ignore_monster_armor"> core ignore armor (ex 0.2):</label>
        <input type="text" id="core_ignore_monster_armor" name="core_ignore_monster_armor"> 
        <label for="skill_ignore_monster_armor"> skill ignore armor (ex 0.2):</label>
        <input type="text" id="skill_ignore_monster_armor" name="skill_ignore_monster_armor">
    </form>
    <h2>Select mode</h2>
    <form id="dropdownForm">
        <label for="mode"> Select force type:</label>
        <select id="mode" name="mode">
            <option value="normal">일반 몬스터</option>
            <option value="boss">보스 몬스터</option>
        </select>
    </form>
    <button type="button" onclick="submitForm()">Submit</button>
    <form id="headerForm">
    <label>One line Damage:</label>
    <p id="old"></p>
    <label>Full Damage:</label>
    <p id="fd"></p>
    <label>Mob HP:</label>
    <p id="hp"></p>
    </form> 
    <script>
        function update_map_region(){
            const force_type = document.getElementById('force_type');
            const map_region = document.getElementById('map_region');

            map_region.innerHTML='';
            if (force_type.value === 'arcane'){
                const options= ['--select--', '소멸의 여로'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_region.appendChild(opt);
                })
            }
            else if (force_type.value === 'authentic'){
                const options= ['--select--', '세르니움', '오디움', '도원경'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_region.appendChild(opt);
                })
            }
            map_region.disabled=false;
            const map_name = document.getElementById('map_name');
            map_name.innerHTML='';
            map_name.disabled=true;
        }
        function update_map_name(){
            const map_region = document.getElementById('map_region');
            const map_name = document.getElementById('map_name');

            map_name.innerHTML='';

            if (map_region.value === '소멸의 여로'){
                const options= ['풍화된 기쁨의 땅', '풍화된 기쁨과 분노의 땅', '풍화된 분노의 땅', '풍화된 분노와 슬픔의 땅', '풍화된 슬픔의 땅', '풍화된 슬픔과 즐거움의 땅', '풍화된 즐거움의 땅', '숨겨진 호숫가', '암석의 영토', '암석과 화염의 영토', '화염의 영토', '화염과 영혼의 영토', '영혼의 영토', '숨겨진 화염지대', '세 갈래길1', '동굴의 서쪽길1', '동굴의 서쪽길2', '동굴의 동쪽길1', '동굴의 동쪽길2', '세 갈래길2', '동굴 위쪽', '동굴 아래쪽', '동굴의 깊숙한 곳', '아르마의 은신처', '숨겨진 동굴'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_name.appendChild(opt);
                })
            }
            else if (map_region.value === '세르니움'){
                const options= ['해변 암석지대 1', '해변 암석지대 2', '해변 암석지대 3', '해변 암석지대 4', '세르니움 서쪽 성벽 1', '세르니움 서쪽 성벽 2', '세르니움 서쪽 성벽 3', '왕립 도서관 제1구역', '왕립 도서관 제2구역', '왕립 도서관 제3구역', '왕립 도서관 제4구역', '왕립 도서관 제5구역', '왕립 도서관 제6구역', '세르니움 동쪽 성벽 1', '세르니움 동쪽 성벽 2', '세르니움 동쪽 성벽 3', '불타는 왕립 도서관 제1구역', '불타는 왕립 도서관 제2구역', '불타는 왕립 도서관 제3구역', '불타는 왕립 도서관 제4구역', '불타는 왕립 도서관 제5구역', '불타는 왕립 도서관 제6구역', '격전의 서쪽 성벽 1', '격전의 서쪽 성벽 2', '격전의 서쪽 성벽 3', '격전의 서쪽 성벽 4', '격전의 동쪽 성벽 1', '격전의 동쪽 성벽 2', '격전의 동쪽 성벽 3', '격전의 동쪽 성벽 4', '격전의 동쪽 성벽 5', '격전의 동쪽 성벽 6'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_name.appendChild(opt);
                })
            }
            else if (map_region.value === '오디움'){
                const options= ['성문으로 가는 길 3', '성문으로 가는 길 4'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_name.appendChild(opt);
                })
            }
            else if (map_region.value === '도원경'){
                const options= ['생기가 돌아오는 봄 1', '생기가 돌아오는 봄 2'];
                options.forEach(option => {
                    const opt = document.createElement('option');
                    opt.value = option;
                    opt.textContent = option;
                    map_name.appendChild(opt);
                })
            }
            map_name.disabled=false;
        }
        function submitCharactername(){
            const characterName=document.getElementById('nameInput').value
            if (characterName){
                fetch(`/initialize/${encodeURIComponent(characterName)}`)
                    .then(response => response.json())
                    .then(data =>{
                        if (data[0].length===2){
                            localStorage.setItem('guild_doping', JSON.stringify(data[0][0]))
                            localStorage.setItem('spec_final', JSON.stringify(data[0][1]))
                            localStorage.setItem('time', data[1])
                            alert('데이터 불러오기가 완료되었습니다.')
                        }
                        else{
                            console.error('expected 2 elements.')
                        }
                    })
                    .catch(error =>{
                        console.error('error:', error);
                    });
            }
            
        }
        function submitForm() {
            // 체크된 항목을 가져옵니다
            const mode = document.getElementById('mode').value
            const dopings = document.querySelectorAll('input[name="doping"]:checked');
            const skill_damage = document.getElementById('skill_damage').value
            const attack_count = document.getElementById('attack_count').value
            const hyper_damage = document.getElementById('hyper_damage').value
            const core_reinforce = document.getElementById('core_reinforce').value
            const core_ignore_monster_armor = document.getElementById('core_ignore_monster_armor').value
            const skill_ignore_monster_armor = document.getElementById('skill_ignore_monster_armor').value
            const force_type = document.getElementById('force_type').value
            const map_region = document.getElementById('map_region').value
            const map_name = document.getElementById('map_name').value
            const specFinal = localStorage.getItem('spec_final');
            const guild_doping = localStorage.getItem('guild_doping');
            let selectedItems = [];
            dopings.forEach((doping) => {
                selectedItems.push(`doping=${doping.value}`);
            });
            if (mode){
                selectedItems.push(`mode=${mode}`);
            }
            if (skill_damage){
                selectedItems.push(`dmg=${skill_damage}`);
            }
            if (attack_count){
                selectedItems.push(`attack_count=${attack_count}`);
            }
            if (hyper_damage){
                selectedItems.push(`hyper_damage=${hyper_damage}`);
            }
            if(core_reinforce){
                selectedItems.push(`core_reinforce=${core_reinforce}`);
            }
            if(core_ignore_monster_armor){
                selectedItems.push(`core_igm=${core_ignore_monster_armor}`);
            }
            if(skill_ignore_monster_armor){
                selectedItems.push(`skill_igm=${skill_ignore_monster_armor}`);
            }
            if(force_type){
                selectedItems.push(`map_type=${force_type}`);
            }
            if(map_region){
                selectedItems.push(`map_region=${map_region}`);
            }
            if(map_name){
                selectedItems.push(`map_name=${map_name}`);
            }
            if(specFinal){
                selectedItems.push(`final=${specFinal}`);
            }
            if(guild_doping){
                selectedItems.push(`guild_doping=${guild_doping}`);
            }
            const queryString = selectedItems.join('&');
            // GET 요청을 보냅니다
            fetch(`/calculate/?${queryString}`)
                .then(response => response.json())
                .then(data => {
                    // 결과를 HTML에 표시합니다
                    const old = document.getElementById('old');
                    const fd = document.getElementById('fd');
                    const mob_hp = document.getElementById('hp');
                    old.innerHTML = '';
                    fd.innerHTML = '';
                    mob_hp.innerHTML = '';  // 기존 내용을 지웁니다
                    const p0 = document.createElement('p');
                    p0.textContent = data[0];
                    old.appendChild(p0)
                    const p1 = document.createElement('p');
                    p1.textContent = data[1];
                    fd.appendChild(p1)
                    const p2 = document.createElement('p');
                    p2.textContent = data[2];
                    mob_hp.appendChild(p2)
                })
                .catch(error => {
                    console.error('Error:', error);
                });
        }
    </script>

</body>
</html>